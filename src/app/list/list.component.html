<div class="container max-w-4xl mx-auto pt-10">
  <div class="flex justify-between">
    <div class="flex flex-col gap-1">
  <span class="font-poppins font-medium text-xl text-neutral-900">
    Liste des demandes
  </span>
      <span class="font-inter text-sm text-neutral-600">
    Gérer les demandes d'autorisation de travaux.
  </span>
    </div>
    <button mat-flat-button class="rounded-sm bg-blue-600" (click)="add()">
      <mat-icon>add</mat-icon>
      <span class="font-inter text-sm font-medium">Ajouter</span>
    </button>
  </div>

  @let projets = $projets | async;
  @for (projet of projets; track $index) {
    <mat-card class="p-4 mt-4 bg-white">
      <div class="flex justify-between">
        <div class="flex gap-4">
          <div>
            <div class="rounded-full p-4 bg-blue-200">
              <svg xmlns="http://www.w3.org/2000/svg" width="18.869" height="22" viewBox="0 0 18.869 22">
                <path id="Tracé_286" data-name="Tracé 286" d="M20,9.5V6.8a7.453,7.453,0,0,0-.327-3.162,3,3,0,0,0-1.311-1.311A7.453,7.453,0,0,0,15.2,2H8.8a7.453,7.453,0,0,0-3.162.327A3,3,0,0,0,4.327,3.638,7.453,7.453,0,0,0,4,6.8V17.2a7.453,7.453,0,0,0,.327,3.162,3,3,0,0,0,1.311,1.311A7.453,7.453,0,0,0,8.8,22H14m0-11H8m2,4H8m8-8H8m8.5,8a2.248,2.248,0,0,1,4.369.75c0,1.5-2.248,2.248-2.248,2.248m.029,3h.01" transform="translate(-3 -1)" fill="none" stroke="#0086c9" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
              </svg>
            </div>
          </div>
          <div class="flex flex-col gap-2">
            <div>
              <div class="font-inter text-sm text-neutral-600">Demande d'autorisation de travaux</div>
              <div class="text-base font-poppins font-medium text-neutral-900">{{projet.name}}</div>
            </div>
            <div class="flex gap-4">
              <span class="bg-neutral-900 text-white px-3 py-1 rounded-md text-sm font-inter">{{projet.user}}</span>
              @if (projet.contract) {
                <span class="bg-neutral-100  px-3 py-1 rounded-md text-sm font-inter">Contrat {{projet.contract}}</span>
              }
            </div>
            <!--<mat-chip-set>
            une autre possibilité avec des chips mais c'est une solution plus lourde
              <mat-chip [disableRipple]="true">{{projet.user}}</mat-chip>
              @if (projet.contract) {
                <mat-chip [disableRipple]="true">Contrat {{projet.contract}}</mat-chip>
              }
            </mat-chip-set>-->
          </div>
        </div>
        <div>
          <div class="flex gap-2 items-center">
            <div>
              <div class="font-archivo font-medium text-sm rounded-full py-2 px-4"
              [ngClass]="{
              'bg-[#FEF0C7] text-[#DC6803]': projet.status === StatusE.PENDING,
              'bg-[#87CEEB] text-[#032B44]': projet.status === StatusE.WORKING,
              'bg-[#C6F4D6] text-[#006400]': projet.status === StatusE.TERMINATE,
              }">
                @switch (projet.status) {
                  @case (StatusE.PENDING) {
                    {{'En attente' | uppercase}}
                  }
                  @case (StatusE.WORKING) {
                    {{'En cours' | uppercase}}
                  }
                  @case (StatusE.TERMINATE) {
                    {{'Terminé' | uppercase}}
                  }

                }
              </div>
            </div>
            <ng-container *ngTemplateOutlet="buttonTemplate; context: {projet: projet}"/>
          </div>
        </div>

      </div>
    </mat-card>
  }

</div>

<ng-template #buttonTemplate let-projet="projet">
  <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="menu-projet">
    <mat-icon>more_vert</mat-icon>
  </button>
  <mat-menu #menu="matMenu">
    <button mat-menu-item (click)="edit(projet)">
      <mat-icon>edit</mat-icon>
      <span>Editer</span>
    </button>
    <button mat-menu-item (click)="delete(projet)">
      <mat-icon>delete</mat-icon>
      <span>Supprimer</span>
    </button>
  </mat-menu>
</ng-template>


